<!-- Chart.js CDNを追加 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- グラフエリア -->
<div class="chart-container">
    <h2>Googleの評価推移</h2>
    <canvas id="ratingChart" width="400" height="300"></canvas>
</div>

<!-- スクリプト部分に追加 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // プラットフォームタブの切り替え
    const tabs = document.querySelectorAll('.platform-tab');
    const platforms = ['Google', 'Yelp', 'TripAdvisor'];
    const colors = {
        'Google': 'rgb(66, 133, 244)',
        'Yelp': 'rgb(224, 7, 7)',
        'TripAdvisor': 'rgb(0, 128, 0)'
    };
    
    // 初期グラフ描画
    createRatingChart('Google');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            const platform = this.textContent;
            document.querySelector('.chart-container h2').textContent = platform + 'の評価推移';
            createRatingChart(platform);
        });
    });
    
    // グラフ生成関数
    function createRatingChart(platform) {
        const ctx = document.getElementById('ratingChart').getContext('2d');
        
        // ダミーデータ - 実際の実装ではAPIから取得
        const data = {
            'Google': {
                months: ['1月', '2月', '3月', '4月', '5月'],
                ratings: [4.1, 4.2, 4.0, 4.5, 4.3],
                reviews: [15, 18, 22, 30, 39]
            },
            'Yelp': {
                months: ['1月', '2月', '3月', '4月', '5月'],
                ratings: [3.8, 4.0, 4.1, 4.2, 4.3],
                reviews: [10, 15, 12, 18, 20]
            },
            'TripAdvisor': {
                months: ['1月', '2月', '3月', '4月', '5月'],
                ratings: [4.0, 3.9, 4.2, 4.3, 4.1],
                reviews: [8, 12, 15, 14, 19]
            }
        };
        
        // 既存のグラフを破棄（プラットフォーム切替時に必要）
        if (window.ratingChart) {
            window.ratingChart.destroy();
        }
        
        window.ratingChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data[platform].months,
                datasets: [{
                    label: '平均評価',
                    data: data[platform].ratings,
                    backgroundColor: colors[platform],
                    borderColor: colors[platform],
                    tension: 0.3,
                    yAxisID: 'y'
                }, {
                    label: 'レビュー数',
                    data: data[platform].reviews,
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    type: 'bar',
                    yAxisID: 'y1'
                }]
            },
            options: {
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        min: 0,
                        max: 5,
                        title: {
                            display: true,
                            text: '平均評価'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        min: 0,
                        title: {
                            display: true,
                            text: 'レビュー数'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                },
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }
});
</script>
